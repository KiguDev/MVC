
@{
    ViewData["Title"] = "Productos";
}


<div class="row" id="card-container" style="margin-top:40px;">

</div>


@section Scripts{

    <script>
        
        var urlParams = new URLSearchParams(window.location.search);
        var idOrden = urlParams.get("id");
        $(document).ready(function () {
            //$('.modal').modal();
            fetch("https://localhost:44389/api/productos").then(function (response) { return response.json() }).then(function (jsonResponse) {
                $.each(jsonResponse, function (index, value) {
                    var precio = jsonResponse[index]["precio"];
                    var idProducto = jsonResponse[index]["id"];
                    var cardCol = document.createElement("div");
                    cardCol.className = "col s4";
                    var card = document.createElement("div");
                    card.className = "card";
                    var cardImage = document.createElement("div")
                    cardImage.className = "card-image";
                    var a = document.createElement("a");
                    a.className = "btn-floating halfway-fab waves-effect waves-light red";
                    a.addEventListener("click", function () { AgregarProducto(idProducto); });
                    var icon = document.createElement("i");
                    icon.className = "material-icons";
                    icon.innerHTML = "add";
                    a.appendChild(icon);
                    cardImage.appendChild(a);
                    var image = document.createElement("img");
                    image.src = jsonResponse[index]['imagen'];
                    image.width = 200;
                    image.height = 200;
                    var cardContent = document.createElement("div");
                    cardContent.className = "card-content"
                    var input = document.createElement("input");
                    input.type = "number";
                    input.id = `cantidad-${idProducto}`;
                    input.placeholder = "Cantidad";
                    var content = document.createElement("p");
                    content.innerHTML = `Precio: $${precio}`;
                    content.className = "flow-text";
                    cardContent.appendChild(content);
                    cardContent.appendChild(input);
                    var title = document.createElement("span");
                    title.className = "card-title";
                    title.innerHTML = jsonResponse[index]['nombre'];
                    cardImage.appendChild(image);
                    cardImage.appendChild(title);
                    card.appendChild(cardImage);
                    card.appendChild(cardContent)
                    cardCol.appendChild(card);
                    var cardContainer = document.getElementById("card-container");
                    cardContainer.appendChild(cardCol);
                });
            });
        });

        function AgregarProducto(id) {
            var cantidad = document.getElementById(`cantidad-${id}`).value;
            console.log(`${id} ${idOrden} ${cantidad}`);
            var data = {
                ordenId: idOrden,
                productoId: id,
                cantidad: cantidad
            }
            var requestOptions = { method: 'POST', body: JSON.stringify(data), headers: { 'Content-Type': 'application/json' } };

            fetch('https://localhost:44389/api/orderdetails', requestOptions).then(function (response) {
                if (response.ok) {
                    window.location.replace(`/orderdetails?id=${idOrden}`);
                }
            });
        };

    </script>
}